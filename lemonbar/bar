#!/usr/bin/bash

# Colors
b="%{B-}"
c1="%{B#732f5b}"
c2="%{B#362b40}"
c3="%{B#9e3909}"
c4="%{B#224173}"

Hora() {
  h=$(date +'%A %d-%m-%Y %I:%M %p')
  echo "$c3 󰥔 $h $b"
}

Wifi() {
  if ping -q -c 1 -W 2 8.8.8.8 >/dev/null; then
    echo "$c1 󰖩 Connected $b"
  else
    echo "$c1 󰖩 Disconnected $b"
  fi
}

Batery() {
  BATERY=$(cat /sys/class/power_supply/BATT/capacity)
  STATUS=$(cat /sys/class/power_supply/BATT/status)

  if [ "$BATERY" -ge 90 ]; then
    ICON=""
  elif [ "$BATERY" -ge 70 ]; then
    ICON=""
  elif [ "$BATERY" -ge 40 ]; then
    ICON=""
  elif [ "$BATERY" -ge 20 ]; then
    ICON=""
  else
    ICON=""   
	fi
  echo "$c2 $ICON $BATERY% $STATUS $b"
}

Title() {
  len=$(echo -n "$(xdotool getwindowfocus getwindowname)" | wc -m)
  max_len=70
  if [ "$len" -gt "$max_len" ];then
    echo -n "$(xdotool getwindowfocus getwindowname | cut -c 1-$max_len)..."
  else
    echo -n "$(xdotool getwindowfocus getwindowname)"
  fi
}

Workspaces() {
	ACTUAL=$(xprop -root _NET_CURRENT_DESKTOP | awk '{print $3}')
	case $ACTUAL in
		0)
			echo "$c4  $b 󰖟     "
		;;
		1)
			echo "  $c4 󰖟 $b    "
		;;
		2)
			echo "   󰖟 $c4  $b  "
		;;
		3)
			echo "   󰖟   $c4  $b "
		;;
    4)
      echo "   󰖟     "

	esac
}

while true; do
  echo "%{l}$(Workspaces) %{c}$(Title) %{r}$(Batery) | $(Wifi) | $(Hora)"
  sleep 1s
done | lemonbar -d -p -f "JetBrainsMono Nerd Font:size=8" -B "#000000" &
